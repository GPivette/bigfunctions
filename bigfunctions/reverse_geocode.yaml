type: function_py
category: geo
author:
  name: Guillaume Pivette
  url: https://www.linkedin.com/in/guillaume-pivette
  avatar_url: ""
description: Get address details from geo_coordinates using Google Maps
arguments:
  - name: latitude
    type: numeric
  - name: longitude
    type: numeric
output:
  name: address_details
  type: string
examples:
  - description: ""
    arguments:
      - 48.86988770000001
      - 2.3079341
    output: |
      {
          "address_components": [...],
          "formatted_address": "1 Av. des Champs-Élysées, 75008 Paris, France",
          "geometry": {
              "location": {
                  "lat": 48.86988770000001,
                  "lng": 2.3079341
              },
              ...
          },
          "place_id": "ChIJ6499V8Rv5kcR5f9dbz3OeBI",
          "plus_code": {...},
          "types": ["street_address"]
      }
    region: ALL
code: |
  import json
  import googlemaps
  import google.cloud.secretmanager
  secret_manager = google.cloud.secretmanager.SecretManagerServiceClient()
  gmaps_api_key = secret_manager.access_secret_version(
      name='projects/bigfunctions/secrets/gmaps_api_key/versions/latest'
  ).payload.data.decode('UTF-8')
  gmaps = googlemaps.Client(key=gmaps_api_key)
  geocode = gmaps.reverse_geocode((latitude, longitude))
  if not geocode:
    return None
  return json.dumps(geocode[0], ensure_ascii=False)
requirements: |
  google-cloud-secret-manager
  googlemaps
